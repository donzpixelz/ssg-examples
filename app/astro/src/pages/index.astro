---
import BaseLayout from '../layouts/BaseLayout.astro';

// Gather latest posts
const posts = (await Astro.glob('./posts/*.md'))
    .sort((a, b) => new Date(b.frontmatter.date) - new Date(a.frontmatter.date))
    .slice(0, 8);
---
<BaseLayout title="Astro Example · Home" description="Starter Astro layout with helpful sections, latest posts, and clear deploy notes.">
  {/* Wrap all sections in a grid container */}
  <div class="two-col">
    <section class="card hero">
      <h1>Astro Example</h1>
      <p>This section lives under <code>/astro/</code>. Pages are in <code>src/pages/</code>, layouts in <code>src/layouts/</code>, and styles in <code>public/css/main.css</code>. The header/nav come from your <code>BaseLayout.astro</code>.</p>
      <p>
        <a class="button" href={import.meta.env.BASE_URL + 'posts/'}>Open the blog</a>
        <a class="button secondary" href={import.meta.env.BASE_URL + 'about/'}>About</a>
        <a class="button secondary" href={import.meta.env.BASE_URL + 'contact/'}>Contact</a>
      </p>
    </section>

    <section class="card">
      <h2>Get started</h2>
      <ol>
        <li>Edit this page: <code>src/pages/index.astro</code></li>
        <li>Add a post: <code>src/pages/posts/my-post.md</code> (set <code>date:</code> and <code>layout: ../../layouts/BlogPost.astro</code>)</li>
        <li>Build locally: <code>npx astro build</code></li>
        <li>Deploy (see commands below)</li>
      </ol>
    </section>

    <section class="card">
      <h2>Project structure (quick tour)</h2>
      <pre><code>app/astro/
├── astro.config.mjs        # base: '/astro/'
├── public/
│   └── css/
│       └── main.css        # styles (brand blue #3466cb)
└── src/
    ├── layouts/
    │   ├── BaseLayout.astro
    │   └── BlogPost.astro
    └── pages/
        ├── index.astro
        ├── about.astro
        ├── contact.astro
        └── posts/
            ├── index.astro
            ├── hello-world.md
            └── second-post.md
</code></pre>
    </section>

    <section class="card">
      <h2>Latest posts</h2>
      {posts.length === 0 ? (
          <p>No posts yet. Create one in <code>src/pages/posts/</code>, then rebuild.</p>
      ) : (
          posts.map(p => (
              <div class="list-item">
                <a href={p.url}><strong>{p.frontmatter.title}</strong></a>
                {p.frontmatter.date && (
                    <small> — {new Date(p.frontmatter.date).toLocaleDateString(undefined, { month: 'short', day: 'numeric', year: 'numeric' })}</small>
                )}
              </div>
          ))
      )}
      <p style="margin-top:.6rem">
        <a class="button" href={import.meta.env.BASE_URL + 'posts/'}>View all posts</a>
      </p>
    </section>

    <section class="card">
      <h2>Deploy to EC2 (quick)</h2>
      <p>Build locally, then sync the <code>dist/</code> output to your Nginx <code>/astro/</code> path.</p>
      <pre><code>npx astro build
rsync -avz --delete -e "ssh -i /Users/donwilson/.ssh/ssg-examples-key.pem" \
  dist/ ec2-user@18.220.33.0:/usr/share/nginx/html/astro/</code></pre>
      <p>Adjust the SSH key, host, or target path if yours differ.</p>
    </section>

    <section class="card">
      <h2>Other examples on this server</h2>
      <ul>
        <li><a href="/hugo/">Hugo</a></li>
        <li><a href="/jekyll/">Jekyll</a></li>
        <li><a href="/eleventy/">Eleventy</a></li>
      </ul>
    </section>
  </div>
</BaseLayout>
