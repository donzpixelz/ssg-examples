#!/usr/bin/env bash
# Full, copy-pasteable Bash file
# File: ./deploy_site_now

set -euo pipefail
MSG="${1:-site: update}"

# ---- repo root ----
cd /Users/.projects/ssg-examples

echo "ğŸ“ Repo: $(pwd)"
CURBR="$(git branch --show-current 2>/dev/null || true)"
echo "ğŸŒ¿ Branch: $CURBR"

git add -A
if git diff --cached --quiet; then
  echo "â„¹ï¸  No local changes to commit."
else
  git commit -m "$MSG"
fi

git fetch origin
git pull --rebase origin "$CURBR"
git push -u origin "$CURBR"

WORKFLOW_FILE="deploy-site-ssm.yml"
if command -v gh >/dev/null 2>&1; then
  gh workflow run "${WORKFLOW_FILE}" --ref "$CURBR" || true
fi

# Always open the Actions tab (exactly /actions)
ACTIONS_URL="https://github.com/donzpixelz/ssg-examples/actions"
echo "ğŸŒ Opening Actions tab: $ACTIONS_URL"
if [ -x /usr/bin/open ]; then
  /usr/bin/open "$ACTIONS_URL"
else
  echo "ğŸ”— $ACTIONS_URL"
fi

echo "âœ… Done."
